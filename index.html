<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <title>Conecta Sa√∫de</title>
    <style>
        :root {
            --primary-color: #007bff; /* Azul padr√£o do Bootstrap */
            --secondary-color: #6c757d; /* Cinza */
            --background-light: #f8f9fa; /* Fundo claro */
            --text-color: #343a40; /* Texto escuro */
            --chat-bubble-user: #e2f0fe; /* Azul claro para o usu√°rio */
            --chat-bubble-bot: #f1f1f1; /* Cinza claro para o bot */
        }

        body {
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            color: var(--text-color);
            background-color: var(--background-light);
            overflow-x: hidden; /* Evita scroll horizontal em transi√ß√µes */
        }

        /* Classes de anima√ß√£o */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .pulse-effect {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .chat-bubble {
            padding: 12px 18px;
            border-radius: 20px;
            margin-bottom: 10px;
            max-width: 80%;
            word-wrap: break-word; /* Garante que o texto quebre */
        }
        .chat-bubble-bot {
            background-color: var(--chat-bubble-bot);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        .chat-bubble-user {
            background-color: var(--chat-bubble-user);
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .chat-container {
            max-height: calc(100vh - 200px); /* Altura fixa para o chat */
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            padding-bottom: 10px; /* Espa√ßo para o input */
        }
        .chat-input-area {
            position: sticky;
            bottom: 0;
            background-color: var(--background-light);
            padding: 10px 0;
            border-top: 1px solid #dee2e6;
        }

        /* Ajustes para o QR Reader */
        #qr-reader {
            max-width: 300px; /* Tamanho mais amig√°vel em mobile */
            margin-left: auto;
            margin-right: auto;
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            overflow: hidden; /* Para garantir que o v√≠deo n√£o escape */
        }
        #qr-reader__dashboard {
            display: none !important; /* Esconde o painel de controle do html5-qrcode */
        }
        
        /* Layout de header */
        header {
            background-color: #fff;
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        header .logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8em;
            margin-right: 10px;
        }
        header .app-title {
            font-size: 1.2em;
            font-weight: bold;
            color: var(--text-color);
        }

        /* Rem√©dio Item */
        .remedio-item {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 10px;
            padding: 15px;
            background-color: #fff;
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: var(--text-color);
            text-decoration: none;
        }
        .remedio-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            background-color: #f0f8ff; /* Leve azul ao passar o mouse */
        }
        .remedio-item input[type="checkbox"] {
            transform: scale(1.5); /* Checkbox maior */
            margin-right: 15px;
        }
        .remedio-item .bi-check-circle-fill {
            color: var(--primary-color);
            font-size: 1.8em;
        }
        .remedio-item .bi-question-circle-fill {
            font-size: 1.8em;
            color: var(--secondary-color);
        }
    </style>
</head>
<body class="bg-light">

    <header>
        <div class="d-flex align-items-center">
            <div class="logo">CS</div>
            <span class="app-title">Conecta Sa√∫de</span>
        </div>
        </header>

    <div id="view-welcome" class="container text-center p-4 vh-100 d-flex flex-column justify-content-center fade-in">
        <h1 class="display-5 fw-bold mb-4">Cuidando da sua recupera√ß√£o em casa.</h1>
        <p class="lead mb-4">Aponte a c√¢mera para o QR Code da sua receita de alta para come√ßar.</p>
        <button id="btn-start-scan" class="btn btn-primary btn-lg pulse-effect">
            <i class="bi bi-qr-code-scan me-2"></i> Escanear QR Code
        </button>
        
        <div id="qr-reader" class="mt-4" style="display: none;"></div>
        <p id="scan-feedback" class="text-muted small mt-3" style="display: none;">Centralizando o QR Code...</p>
    </div>

    <div id="view-receita" class="container p-3 fade-in" style="display: none;">
        <h2 class="mb-3">Ol√°, <span id="nome-paciente" class="text-primary"></span>!</h2>
        <p class="text-muted">Sua prescri√ß√£o est√° pronta. Marque os itens conclu√≠dos e toque para tirar d√∫vidas.</p>
        
        <div id="lista-remedios" class="d-flex flex-column gap-2">
            </div>

        <div class="d-grid gap-2 mt-4">
            <button id="btn-panico" class="btn btn-danger btn-lg">
                <i class="bi bi-exclamation-triangle-fill me-2"></i> N√£o estou me sentindo bem
            </button>
        </div>
    </div>

    <div id="view-chat" class="container d-flex flex-column vh-100 p-0 fade-in" style="display: none;">
        <div class="d-flex align-items-center p-3 border-bottom bg-white sticky-top">
            <button id="btn-chat-voltar" class="btn btn-outline-secondary me-3">
                <i class="bi bi-arrow-left"></i>
            </button>
            <h5 class="m-0">BulaBot Assistente</h5>
        </div>
        
        <div class="chat-container p-3 flex-grow-1">
            <div class="chat-bubble chat-bubble-bot">
                Ol√°! Sou seu assistente para d√∫vidas sobre: <strong id="chat-remedio-nome" class="text-primary"></strong>. Como posso ajudar?
            </div>
            
            <div id="chat-predefined-responses" class="mt-2">
                <div id="resp-efeitos" class="chat-bubble chat-bubble-bot" style="display: none;">
                    <strong>Efeitos Colaterais:</strong><br>
                    Os efeitos mais comuns para este medicamento incluem rea√ß√µes al√©rgicas, queda da press√£o e, raramente, rea√ß√µes na pele. N√°useas s√£o poss√≠veis. Se sentir algo grave, por favor, utilize o bot√£o "N√£o estou me sentindo bem" na tela anterior.
                </div>
                 <div id="resp-esqueci" class="chat-bubble chat-bubble-bot" style="display: none;">
                    <strong>Esqueci uma dose:</strong><br>
                    Tome a dose assim que lembrar. No entanto, se estiver quase na hora da pr√≥xima dose, pule a dose esquecida e volte ao seu hor√°rio regular. N√£o tome duas doses ao mesmo tempo.
                </div>
                 <div id="resp-posso_beber" class="chat-bubble chat-bubble-bot" style="display: none;">
                    <strong>Sobre √Ålcool:</strong><br>
                    Para a maioria dos medicamentos, n√£o √© recomendado o consumo de √°lcool, pois pode aumentar o risco de efeitos colaterais e sobrecarregar o f√≠gado. Consulte sempre seu m√©dico.
                </div>
                <div id="resp-generica" class="chat-bubble chat-bubble-bot" style="display: none;">
                    Desculpe, n√£o entendi sua pergunta. Poderia reformular? Ou selecione uma das op√ß√µes abaixo.
                </div>
            </div>

            <div id="typing-indicator" class="chat-bubble chat-bubble-bot" style="display: none;">
                Digitando...
            </div>
        </div>

        <div class="chat-input-area p-3 bg-white">
            <div class="input-group">
                <input type="text" id="chat-input" class="form-control rounded-pill" placeholder="Pergunte sobre o rem√©dio..." aria-label="Pergunte sobre o rem√©dio...">
                <button class="btn btn-primary rounded-pill ms-2" type="button" id="btn-send-message">
                    <i class="bi bi-send-fill"></i>
                </button>
            </div>
            <div id="chat-sugestoes" class="d-flex flex-wrap gap-2 mt-2 justify-content-center">
                 <button class="btn btn-sm btn-outline-primary" onclick="enviarPerguntaSugestao('Quais os efeitos colaterais?')">Efeitos?</button>
                 <button class="btn btn-sm btn-outline-primary" onclick="enviarPerguntaSugestao('Esqueci uma dose.')">Esqueci dose?</button>
                 <button class="btn btn-sm btn-outline-primary" onclick="enviarPerguntaSugestao('Posso beber?')">Beber √°lcool?</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    
    <script>
        // --- SE√á√ÉO DE REFER√äNCIAS DA DOM ---
    const viewWelcome = document.getElementById('view-welcome');
    const viewReceita = document.getElementById('view-receita');
    const viewChat = document.getElementById('view-chat');
    
    const btnStartScan = document.getElementById('btn-start-scan');
    const qrReaderDiv = document.getElementById('qr-reader');
    const scanFeedback = document.getElementById('scan-feedback');
    
    const listaRemedios = document.getElementById('lista-remedios');
    const nomePaciente = document.getElementById('nome-paciente');
    const btnPanico = document.getElementById('btn-panico');

    const btnChatVoltar = document.getElementById('btn-chat-voltar');
    const chatRemedioNome = document.getElementById('chat-remedio-nome');
    const chatRemedioNome2 = document.getElementById('chat-remedio-nome-2'); // Para o bal√£o inicial do bot
    const chatContainer = document.querySelector('#view-chat .chat-container'); // Onde as msgs v√£o
    const chatInput = document.getElementById('chat-input');
    const btnSendMessage = document.getElementById('btn-send-message');
    const chatPredefinedResponses = document.getElementById('chat-predefined-responses'); // Manter para a primeira sauda√ß√£o
    const typingIndicator = document.getElementById('typing-indicator');
    const chatSugestoes = document.getElementById('chat-sugestoes'); // Bot√µes de sugest√£o

    const html5QrCode = new Html5Qrcode("qr-reader");

    let currentRemedioContext = null; // Guarda o rem√©dio que est√° sendo discutido
    let fullReceitaData = null; // Para armazenar todos os dados da receita ap√≥s o scan

    // --- BANCO DE DADOS DE BULAS (CONHECIMENTO EST√ÅTICO) ---
    // Voc√™ pode expandir isso para quantos rem√©dios quiser para a demo.
    const bulaData = {
        "dipirona 500mg": {
            "nome": "Dipirona 500mg",
            "para_que_serve": "√â um analg√©sico e antit√©rmico, usado para aliviar dores e baixar a febre.",
            "efeitos_colaterais": "Os efeitos mais comuns incluem rea√ß√µes al√©rgicas (vermelhid√£o na pele, coceira, incha√ßo), queda da press√£o arterial (hipotens√£o) e, raramente, agranulocitose (diminui√ß√£o grave de gl√≥bulos brancos). N√°useas e v√¥mitos s√£o poss√≠veis, mas menos comuns.",
            "esqueci_dose": "Se esquecer uma dose e for uma dose √∫nica para dor/febre, tome assim que lembrar. Se for um tratamento cont√≠nuo, siga a orienta√ß√£o m√©dica e evite dobrar a dose. Em caso de d√∫vida, pergunte ao seu m√©dico.",
            "alcool": "N√£o √© recomendado consumir √°lcool, pois pode intensificar os efeitos colaterais e sobrecarregar o f√≠gado.",
            "outras_duvidas": "Pode causar colora√ß√£o avermelhada na urina (inofensivo). Evitar em casos de alergia a pirazolonas ou doen√ßas da medula √≥ssea."
        },
        "amoxicilina 250mg": {
            "nome": "Amoxicilina 250mg",
            "para_que_serve": "√â um antibi√≥tico usado para tratar infec√ß√µes bacterianas, como infec√ß√µes de ouvido, garganta, pele e trato urin√°rio.",
            "efeitos_colaterais": "Os efeitos comuns incluem diarreia, n√°useas, v√¥mitos e erup√ß√µes cut√¢neas. Rea√ß√µes al√©rgicas mais graves (incha√ßo no rosto, dificuldade para respirar) s√£o raras, mas requerem aten√ß√£o m√©dica imediata.",
            "esqueci_dose": "Tome a dose esquecida assim que lembrar, a menos que esteja muito pr√≥ximo da pr√≥xima dose (menos de 2 horas). Nesse caso, pule a dose esquecida e continue o esquema normalmente. Nunca tome duas doses para compensar.",
            "alcool": "O consumo de √°lcool durante o tratamento com Amoxicilina n√£o √© diretamente contraindicado, mas pode aumentar a ocorr√™ncia de efeitos gastrointestinais como n√°useas e diarreia, al√©m de sobrecarregar o f√≠gado. √â prudente evitar.",
            "outras_duvidas": "√â importante completar todo o curso do tratamento, mesmo que se sinta melhor, para evitar a resist√™ncia bacteriana."
        },
        "ibuprofeno 200mg": { // Exemplo adicional
            "nome": "Ibuprofeno 200mg",
            "para_que_serve": "Anti-inflamat√≥rio n√£o esteroidal (AINE) usado para dor leve a moderada, febre, inflama√ß√µes e sintomas de resfriado/gripe.",
            "efeitos_colaterais": "N√°useas, dor abdominal, m√° digest√£o (dispepsia), diarreia. Pode causar tontura ou sonol√™ncia. Em uso prolongado, pode afetar rins ou est√¥mago. Pessoas com asma podem ter crises.",
            "esqueci_dose": "Se for uma dose √∫nica, tome ao lembrar. Se for tratamento regular, tome a dose esquecida assim que poss√≠vel, mas n√£o tome uma dose extra para compensar. Siga o intervalo recomendado.",
            "alcool": "Aumenta o risco de irrita√ß√£o g√°strica e sangramento no est√¥mago. O consumo de √°lcool deve ser evitado ou moderado, especialmente se voc√™ j√° tem problemas estomacais.",
            "outras_duvidas": "Tomar com alimentos pode ajudar a reduzir o desconforto estomacal. N√£o deve ser usado por pessoas com √∫lceras g√°stricas."
        }
        // Adicione mais rem√©dios aqui no mesmo formato
    };

    // --- SE√á√ÉO DE NAVEGA√á√ÉO ENTRE TELAS ---
    function mostrarTela(telaId) {
        // Esconde todas as telas
        [viewWelcome, viewReceita, viewChat].forEach(v => v.style.display = 'none');
        // Mostra a tela desejada e adiciona anima√ß√£o
        const targetView = document.getElementById(telaId);
        targetView.style.display = 'flex'; // Usar flex para vh-100 em chat
        targetView.classList.add('fade-in');
        setTimeout(() => targetView.classList.remove('fade-in'), 500); // Remove ap√≥s a anima√ß√£o
    }

    // --- SE√á√ÉO DO LEITOR DE QR CODE ---
    function onScanSuccess(decodedText, decodedResult) {
        scanFeedback.innerText = "Sucesso! Processando...";
        scanFeedback.className = "text-success fw-bold";
        
        html5QrCode.stop().then(() => {
            try {
                fullReceitaData = JSON.parse(decodedText); // Armazena os dados completos da receita
                renderReceita(fullReceitaData);
                mostrarTela('view-receita');
            } catch (error) {
                console.error("FALHA AO PROCESSAR O JSON!", error);
                scanFeedback.innerText = "Erro: Este QR Code n√£o √© uma receita v√°lida.";
                scanFeedback.className = "text-danger fw-bold";
                
                btnStartScan.style.display = 'block';
                qrReaderDiv.style.display = 'none';
                scanFeedback.style.display = 'block'; 
            }
        }).catch(err => {
            console.warn("Erro ao parar a c√¢mera, mas seguimos em frente.", err);
            try {
                fullReceitaData = JSON.parse(decodedText);
                renderReceita(fullReceitaData);
                mostrarTela('view-receita');
            } catch (error) {
                console.error("FALHA AO PROCESSAR O JSON (ap√≥s erro de parada de c√¢mera)!", error);
                scanFeedback.innerText = "Erro: Este QR Code n√£o √© uma receita v√°lida.";
                scanFeedback.className = "text-danger fw-bold";
                btnStartScan.style.display = 'block';
                qrReaderDiv.style.display = 'none';
                scanFeedback.style.display = 'block'; 
            }
        });
    }

    function onScanFailure(error) { /* console.warn(`Scan de QR code falhou: ${error}`); */ }

    btnStartScan.addEventListener('click', () => {
        qrReaderDiv.style.display = 'block';
        scanFeedback.style.display = 'block';
        scanFeedback.innerText = "Centralizando o QR Code...";
        scanFeedback.className = "text-muted small mt-2";
        btnStartScan.style.display = 'none';

        html5QrCode.start(
            { facingMode: "environment" },
            { fps: 10, qrbox: { width: 250, height: 250 } },
            onScanSuccess,
            onScanFailure
        ).catch(err => {
            console.error("Erro ao iniciar a c√¢mera:", err);
            alert("N√£o foi poss√≠vel acessar a c√¢mera. Por favor, verifique as permiss√µes do navegador.");
            btnStartScan.style.display = 'block';
            qrReaderDiv.style.display = 'none';
            scanFeedback.style.display = 'none';
        });
    });


    // --- SE√á√ÉO DA TELA DE RECEITA ---
    function renderReceita(data) {
        nomePaciente.innerText = data.paciente;
        listaRemedios.innerHTML = "";
        
        data.receita.forEach(item => {
            const remedioDiv = document.createElement('div');
            remedioDiv.className = 'remedio-item';

            const checkboxId = `remedio-${item.id}`;
            remedioDiv.innerHTML = `
                <div class="d-flex align-items-center">
                    <input class="form-check-input me-3" type="checkbox" value="" id="${checkboxId}">
                    <div>
                        <h5 class="mb-0">${item.remedio}</h5>
                        <p class="text-muted mb-0 small">${item.posologia}</p>
                        <small class="text-secondary">Por ${item.dias} dias.</small>
                    </div>
                </div>
                <button class="btn btn-link p-0 text-decoration-none" data-remedio-nome="${item.remedio}">
                    <i class="bi bi-question-circle-fill"></i>
                </button>
            `;
            
            remedioDiv.querySelector('button').addEventListener('click', (e) => {
                e.preventDefault();
                currentRemedioContext = item.remedio;
                abrirChat(item.remedio);
            });

            listaRemedios.appendChild(remedioDiv);
        });
    }
    
    btnPanico.addEventListener('click', () => {
        alert('ALERTA ENVIADO! üö®\n\nSua solicita√ß√£o foi enviada √† central de enfermagem. Em breve, um profissional de sa√∫de entrar√° em contato.');
    });

    // --- SE√á√ÉO DO BULABOT (CHAT) ---
    btnChatVoltar.addEventListener('click', () => {
        mostrarTela('view-receita');
    });

    function abrirChat(nomeDoRemedio) {
        currentRemedioContext = nomeDoRemedio;
        chatRemedioNome.innerText = nomeDoRemedio;
        chatRemedioNome2.innerText = nomeDoRemedio;
        
        // Limpa mensagens anteriores (mant√©m apenas a primeira sauda√ß√£o do bot)
        const chatMessages = chatContainer.querySelectorAll('.chat-bubble');
        chatMessages.forEach((msg, index) => {
            if (index > 0) msg.remove(); // Remove tudo exceto a primeira sauda√ß√£o
        });
        chatPredefinedResponses.style.display = 'none'; // Esconde as respostas pr√©-definidas (agora s√£o din√¢micas)

        // Adiciona a sauda√ß√£o inicial do bot espec√≠fica para o rem√©dio
        const initialBotGreeting = document.createElement('div');
        initialBotGreeting.className = 'chat-bubble chat-bubble-bot fade-in';
        initialBotGreeting.innerHTML = `Ol√°! Sou o BulaBot. Estou aqui para tirar suas d√∫vidas sobre: <strong>${nomeDoRemedio}</strong>. Como posso ajudar?`;
        // Remove o primeiro elemento fixo e substitui
        if (chatContainer.firstElementChild) {
            chatContainer.firstElementChild.remove();
        }
        chatContainer.prepend(initialBotGreeting);


        mostrarTela('view-chat');
        chatInput.focus();
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // Simula o envio de mensagem
    btnSendMessage.addEventListener('click', () => {
        enviarPergunta(chatInput.value);
    });

    chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            enviarPergunta(chatInput.value);
        }
    });

    function enviarPergunta(pergunta) {
        if (pergunta.trim() === '') return;

        // Adiciona a mensagem do usu√°rio
        const userBubble = document.createElement('div');
        userBubble.className = 'chat-bubble chat-bubble-user fade-in';
        userBubble.textContent = pergunta;
        chatContainer.appendChild(userBubble);
        chatInput.value = '';
        chatContainer.scrollTop = chatContainer.scrollHeight;

        // Simula a "digita√ß√£o" da IA
        typingIndicator.style.display = 'block';
        chatContainer.scrollTop = chatContainer.scrollHeight;

        setTimeout(() => {
            typingIndicator.style.display = 'none';
            const botResponseBubble = document.createElement('div');
            botResponseBubble.className = 'chat-bubble chat-bubble-bot fade-in';
            botResponseBubble.innerHTML = gerarRespostaIA(pergunta, currentRemedioContext);
            chatContainer.appendChild(botResponseBubble);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }, 1500);
    }

    // --- FUN√á√ÉO CENTRAL DA "IA" ---
    function gerarRespostaIA(pergunta, remedioNomeCompleto) {
        const perguntaLower = pergunta.toLowerCase();
        // Normaliza o nome do rem√©dio para buscar no banco de dados de bulas
        const remedioKey = remedioNomeCompleto.toLowerCase();
        const infoBula = bulaData[remedioKey];

        if (!infoBula) {
            return `Desculpe, n√£o encontrei informa√ß√µes detalhadas sobre "${remedioNomeCompleto}" no meu banco de dados. Para d√∫vidas espec√≠ficas, consulte um profissional de sa√∫de.`;
        }

        // --- Verifica√ß√£o de palavras-chave para respostas espec√≠ficas ---
        if (perguntaLower.includes('efeitos colaterais') || perguntaLower.includes('efeitos') || perguntaLower.includes('mal')) {
            return `Para **${infoBula.nome}**: ${infoBula.efeitos_colaterais}`;
        } 
        if (perguntaLower.includes('esqueci') || (perguntaLower.includes('dose') && perguntaLower.includes('esqueci'))) {
            return `Para **${infoBula.nome}**: ${infoBula.esqueci_dose}`;
        }
        if (perguntaLower.includes('√°lcool') || perguntaLower.includes('beber') || perguntaLower.includes('bebida')) {
            return `Para **${infoBula.nome}**: ${infoBula.alcool}`;
        }
        if (perguntaLower.includes('para que serve') || perguntaLower.includes('fun√ß√£o') || perguntaLower.includes('uso')) {
            return `Para **${infoBula.nome}**: ${infoBula.para_que_serve}`;
        }
        if (perguntaLower.includes('d√∫vidas') || perguntaLower.includes('outras')) {
            if (infoBula.outras_duvidas) {
                return `Para **${infoBula.nome}**: ${infoBula.outras_duvidas}`;
            }
        }
        
        // --- Respostas mais inteligentes para perguntas abertas ---
        if (perguntaLower.includes('ol√°') || perguntaLower.includes('oi')) {
            return `Ol√°! Como posso te ajudar hoje sobre **${infoBula.nome}**?`;
        }
        if (perguntaLower.includes('obrigado') || perguntaLower.includes('valeu')) {
            return `De nada! Se tiver mais alguma d√∫vida sobre **${infoBula.nome}**, √© s√≥ perguntar.`;
        }
        if (perguntaLower.includes('como devo tomar') || perguntaLower.includes('posologia')) {
             // Tenta buscar a posologia do item original da receita (se a receita completa estiver guardada)
             if (fullReceitaData && fullReceitaData.receita) {
                const remedioDaReceita = fullReceitaData.receita.find(r => r.remedio.toLowerCase() === remedioKey);
                if (remedioDaReceita && remedioDaReceita.posologia) {
                    return `Sua prescri√ß√£o para **${infoBula.nome}** √©: "${remedioDaReceita.posologia}". Siga as orienta√ß√µes do seu m√©dico.`;
                }
             }
             return `Para **${infoBula.nome}**, a posologia deve ser seguida conforme a orienta√ß√£o do seu m√©dico na receita. Verifique o seu cart√£o de alta.`;
        }

        // --- Resposta gen√©rica se n√£o reconhecer a pergunta ---
        return `Desculpe, n√£o entendi sua pergunta sobre **${infoBula.nome}**. Poderia tentar reformular ou fazer uma pergunta mais espec√≠fica sobre os **efeitos colaterais**, **esquecer uma dose**, **√°lcool** ou **para que serve**?`;
    }

    // Fun√ß√£o para os bot√µes de sugest√£o (agora mais din√¢micos)
    function enviarPerguntaSugestao(pergunta) {
        enviarPergunta(pergunta);
    }

    // Inicia a tela de boas-vindas
    document.addEventListener('DOMContentLoaded', () => {
        mostrarTela('view-welcome');
    });
    </script>
</body>
</html>